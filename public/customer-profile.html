<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Ai-Maize-ing Nachos</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Shrikhand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Small Corner Logo -->
    <div class="corner-logo">
        <img src="image/LOGO.jpg" alt="Ai-Maize-ing Nachos Logo" onerror="this.style.display='none'">
    </div>

    <div class="container">
        <!-- Header Buttons -->
        <div class="header-buttons">
            <button id="logout-btn" style="background: #dc3545;"><i class="fas fa-sign-out-alt"></i> Logout</button>
            <button onclick="navigateTo('index.html')" style="background: #17a2b8;"><i class="fas fa-home"></i> Home</button>
        </div>

        <!-- Page Header -->
        <div class="page-header">
            <button class="back-btn" onclick="navigateTo('index.html')">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>
            <h1>My Profile</h1>
            <p>View your orders, loyalty points, and account information</p>
        </div>

        <!-- Customer Info Section -->
        <div class="quick-stats">
            <div class="stats-grid">
                <div class="stat-item">
                    <i class="fas fa-user"></i>
                    <h3 id="customer-name">Guest User</h3>
                    <p>Customer</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-star"></i>
                    <h3 id="loyalty-points">0</h3>
                    <p>Loyalty Points</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-shopping-bag"></i>
                    <h3 id="total-orders-count">0</h3>
                    <p>Total Orders</p>
                </div>
                <div class="stat-item">
                    <i class="fas fa-money-bill-wave"></i>
                    <h3 id="total-spent">â‚±0</h3>
                    <p>Total Spent</p>
                </div>
            </div>
        </div>

        <!-- Order History Section -->
        <div class="dashboard-container" style="margin: 30px 0;">
            <h2 style="color: #8b4513; margin-bottom: 20px; font-family: 'Shrikhand', cursive;">
                <i class="fas fa-history"></i> Order History
            </h2>
            <div id="order-history">
                <p style="text-align: center; color: #666; padding: 40px;">No orders yet. Start ordering to see your history here!</p>
            </div>
        </div>

        <!-- Favorite Items Section -->
        <div class="dashboard-container" style="margin: 30px 0;">
            <h2 style="color: #8b4513; margin-bottom: 20px; font-family: 'Shrikhand', cursive;">
                <i class="fas fa-heart"></i> Favorite Items
            </h2>
            <div id="favorite-items">
                <p style="text-align: center; color: #666; padding: 40px;">Your favorite items will appear here after you place orders</p>
            </div>
        </div>

        <!-- Notification Settings -->
        <div class="dashboard-container" style="margin: 30px 0;">
            <h2 style="color: #8b4513; margin-bottom: 20px; font-family: 'Shrikhand', cursive;">
                <i class="fas fa-bell"></i> Notification Settings
            </h2>
            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <input type="checkbox" id="order-notifications" checked>
                <label for="order-notifications" style="font-weight: bold; color: #333;">
                    Receive notifications when my order is ready
                </label>
            </div>
            <p style="color: #666; margin-top: 10px; font-size: 0.9rem;">
                You'll get a notification when your order is ready for pickup
            </p>
        </div>
    </div>

    <!-- Modals -->
    <div id="custom-alert" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <p id="custom-alert-message"></p>
            <button id="custom-alert-ok">OK</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Customer profile specific functions
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ‘¤ Customer profile page initialized');
            
            // Load customer data
            loadCustomerData();
            
            // Setup logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                localStorage.removeItem('customerData');
                showCustomAlert('Logged out successfully!');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            });

            // Setup notification checkbox
            const notificationCheckbox = document.getElementById('order-notifications');
            if (notificationCheckbox) {
                const notificationSetting = localStorage.getItem('orderNotifications');
                notificationCheckbox.checked = notificationSetting !== 'false';
                
                notificationCheckbox.addEventListener('change', function() {
                    localStorage.setItem('orderNotifications', this.checked);
                    showCustomAlert('Notification settings updated!');
                });
            }
        });

        function loadCustomerData() {
            const customerData = JSON.parse(localStorage.getItem('customerData'));
            
            if (!customerData) {
                showCustomerRegistrationModal();
                return;
            }
            
            // Display customer data
            document.getElementById('customer-name').textContent = customerData.name;
            document.getElementById('loyalty-points').textContent = customerData.loyaltyPoints || 0;
            document.getElementById('total-orders-count').textContent = customerData.totalOrders || 0;
            document.getElementById('total-spent').textContent = `â‚±${customerData.totalSpent || 0}`;
            
            // Display order history
            displayOrderHistory(customerData.orderHistory);
            
            // Display favorite items
            displayFavoriteItems(customerData.favoriteItems);
        }

        function displayOrderHistory(orders) {
            const container = document.getElementById('order-history');
            
            if (!orders || orders.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No orders yet. Start ordering to see your history here!</p>';
                return;
            }

            container.innerHTML = orders.map(order => `
                <div class="order-item" style="margin-bottom: 15px; border-left: 5px solid #28a745; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    <div class="order-header" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span class="order-customer" style="font-weight: bold; color: #8b4513;">Order #${order.id ? order.id.slice(-6) : 'N/A'}</span>
                        <span class="order-time" style="color: #666; font-size: 0.9rem;">${new Date(order.orderDate).toLocaleDateString()}</span>
                    </div>
                    <div class="order-details" style="margin-bottom: 10px; color: #333;">
                        ${order.items ? order.items.map(item => 
                            `${item.quantity}x ${item.name} - â‚±${(item.price * item.quantity).toFixed(0)}`
                        ).join('<br>') : 'Order details not available'}
                    </div>
                    <div class="order-total" style="font-weight: bold; margin-bottom: 5px;">Total: â‚±${order.total ? order.total.toFixed(0) : '0'}</div>
                    <div class="order-pickup" style="color: #666; margin-bottom: 10px; font-size: 0.9rem;">Pickup: ${order.pickupTime || 'Not specified'}</div>
                    <div style="margin-top: 10px;">
                        <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${order.status || 'completed'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        function displayFavoriteItems(favorites) {
            const container = document.getElementById('favorite-items');
            
            if (!favorites || favorites.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Your favorite items will appear here after you place orders</p>';
                return;
            }

            const topFavorites = favorites.sort((a, b) => (b.count || 0) - (a.count || 0)).slice(0, 5);
            
            container.innerHTML = topFavorites.map(fav => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8f9fa; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #8b4513;">
                    <span style="font-weight: bold; color: #333;">${fav.name}</span>
                    <span style="color: #666; background: #e9ecef; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">
                        Ordered ${fav.count || 0} time${fav.count !== 1 ? 's' : ''}
                    </span>
                </div>
            `).join('');
        }

        function showCustomerRegistrationModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="login-container">
                    <h2>Create Account</h2>
                    <p style="color: #666; margin-bottom: 20px; text-align: center;">Create an account to track your orders and earn loyalty points!</p>
                    <input type="text" id="register-name" placeholder="Full Name" required>
                    <input type="tel" id="register-phone" placeholder="Phone Number" required>
                    <input type="email" id="register-email" placeholder="Email (Optional)">
                    <input type="password" id="register-password" placeholder="Password" required>
                    <button onclick="registerCustomer()">Create Account</button>
                    <p style="margin-top: 15px; color: #666; text-align: center;">
                        Already have an account? 
                        <a href="#" onclick="showCustomerLoginModal(this)" style="color: #8b4513;">Login here</a>
                    </p>
                </div>
            `;
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function showCustomerLoginModal(link) {
            if (link) {
                link.closest('.modal-overlay').remove();
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="login-container">
                    <h2>Customer Login</h2>
                    <input type="tel" id="login-phone" placeholder="Phone Number" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <button onclick="customerLogin()">Login</button>
                    <p style="margin-top: 15px; color: #666; text-align: center;">
                        Don't have an account? 
                        <a href="#" onclick="showCustomerRegistrationModalFromLogin(this)" style="color: #8b4513;">Create one</a>
                    </p>
                </div>
            `;
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function showCustomerRegistrationModalFromLogin(link) {
            if (link) {
                link.closest('.modal-overlay').remove();
            }
            showCustomerRegistrationModal();
        }

        function registerCustomer() {
            const name = document.getElementById('register-name').value.trim();
            const phone = document.getElementById('register-phone').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;

            if (!name || !phone || !password) {
                showCustomAlert('Please fill in all required fields (Name, Phone, Password)');
                return;
            }

            const customerData = {
                id: Date.now().toString(),
                name: name,
                phone: phone,
                email: email,
                loyaltyPoints: 0,
                totalOrders: 0,
                totalSpent: 0,
                orderHistory: [],
                favoriteItems: [],
                createdAt: new Date().toISOString()
            };

            localStorage.setItem('customerData', JSON.stringify(customerData));
            localStorage.setItem('customerPassword', password);
            
            document.querySelector('.modal-overlay').remove();
            
            showCustomAlert('Account created successfully! Welcome to Ai-Maize-ing Nachos!');
            
            loadCustomerData();
        }

        function customerLogin() {
            const phone = document.getElementById('login-phone').value.trim();
            const password = document.getElementById('login-password').value;

            if (!phone || !password) {
                showCustomAlert('Please enter phone and password');
                return;
            }

            const customerData = localStorage.getItem('customerData');
            const storedPassword = localStorage.getItem('customerPassword');

            if (customerData && storedPassword === password) {
                document.querySelector('.modal-overlay').remove();
                showCustomAlert('Login successful!');
                loadCustomerData();
            } else {
                showCustomAlert('Invalid phone number or password');
            }
        }

        // Make functions available globally
        window.showCustomerRegistrationModal = showCustomerRegistrationModal;
        window.showCustomerLoginModal = showCustomerLoginModal;
        window.showCustomerRegistrationModalFromLogin = showCustomerRegistrationModalFromLogin;
        window.registerCustomer = registerCustomer;
        window.customerLogin = customerLogin;
    </script>
</body>
</html>